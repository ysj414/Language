#

3장 타입과 객체

이 장에서는 파이선 객체 모델의 내부적인 작동 방식을 알아보고
내장 데이터 타입들을 개략적으로 살펴본다. 

소목차
3.1 용어
3.2 객체 신원과 타입
3.3 참조 횟수와 쓰레기 수집
3.4 참조와 복사
3.5 1급 객체
3.6 데이터 표현을 위한 내장 타입
3.7 프로그램 구조를 위한 내장 타입
3.8 인터프리터의 내부를 나타내는 내장 타입
3.9 객체의 작동 방식과 특수 메서드


3.1 용어

신원(identify): 객체가 메모리에 저장된 위치를 가리키는 포인터
타입(=클래스): 객체의 내부적인 표현 형태와 객체가 지원하는 메서드 및 연산들을 설명
인스턴스: 특정 타입의 객체가 생성된 것
변경가능(mutable): 객체의 값을 변경할 수 있음
변경불가능(immutable): 객체의 값을 변경할 수 없음
속성(attribute): 객체에 연결된 값
메서드(method): 호출될 때 객체에 대해 특정 연산을 수행하는 함수

a = 3 +4j # 복소수 생성
r = a.real # 실수부(속성)을 얻음

b = [1, 2, 3] # 리스트 생성
b.append(7) # append 메서드로 새로운 원소를 추가

3.2 객체의 신원과 타입

내장 함수 id()는 객체의 신원을 나타내는 정수를 반환
보통 이 정수는 객체의 메모리 상의 위치를 나타냄
그러나, 이 부분은 파이선 구현에 따라 달라질 수 있기 때문에 신원을 이런 식으로 해석 하지 않는 것이 좋음

#두 객체를 비교

def compare(a,b):
	if a is b:
		#a와 b는 동일한 객체
	if a == b:
		#a와 b는 동일한 값을 가짐
	if type(a) is type(b)
		#a와 b는 동일한 타입

객체의 타입은 객체의 클라스라고 하고 그 자체도 객체
타입은 is 연산자로 비교가 가능

if type(s) is list:
	s.append(imte)
if type(d) is dict:
	d.update(t)

타입은 클래스를 통해 특수화가 가능하기 때문에 내장함수인 isinstance(object, type)를 사용하여 타입을 검사하는 것이 나음

if isinstance(s,list):
	s.append(item)

if isinstance(d,dict):
	d.update(t)

isinstance() 함수는 상속 관계를 인식하기 대문에 어떤 파이썬 객체의 타입을 검사하든지 이 함수를 사용하는 것이 좋음

3.3 참조 횟수와 쓰레기 수집

모든 객체에는 참조 횟수(reference count)가 유지 됨

a = 37	# 객체 생성
b = a	# 37에 대한 참조 횟수 증가
c = []  
c.append(b) # 37에 대한 참조 횟수 증가

del a  # 37에 대한 참조 횟수 하나 감소
b = 42 # 37에 대한 참조 횟수 하나 감소
c[0] = 2.0 # 37에 대한 참조 횟수 하나 감소

객체의 현재 참조는 sys.getrefcount()함수로 얻을 수 있음

>>> a = 37
>>> import sys
>>> sys.getrefcount(a)
7
>>>

객체의 참조횟수가 0이 되면 쓰레기 수집(garbage collection)이 수행
종종 더 이상 사용되지 않는 객체들 간에 순환 의존성(circular dependency)이 존재하는 경우가 있음

a = { }
b = { }
a['b'] = b	# a는 b에 대한 참조를 담고 있음
b['a'] = a  # b는 a에 대한 참조를 담고 있음
del a
del b

3.4 참조와 복사

>>> a = [1, 2, 3, 4]
>>> b = a  # b는 a에 대한 참조
>>> b is a
True
>>> b[2] = -100 # b에 있는 한 원소를 변경
>>> a			# a도 변경된 것에 주목
[1,2,-100,4]
>>>

얕은 복사(shallow copy) - 새로운 객체를 생성하지만 그 안은 원래 객체에 들어 있던 참조로 채워짐

>>> a = [ 1, 2, [3, 4] ]
>>> b = list(a) # a에 대한 얕은 복사본을 생성
>>> b is a
False
>>> b.append(100) # b에 새로운 원소를 하나 추가
>>> b
[1, 2, [3, 4], 100]
>>> a			  # a가 변하지 않은 것에 주목
[1, 2, [3, 4]]
>>> b[2][0] = -100  # b에 들어 있는 원소를 변경
>>> b
[1, 2, [-100, 4], 100]
>>> a               # a도 변한 것에 주목
[1, 2, [-100, 4]]
>>>

깊은 복사(deep copy)는 새로운 객체를 생성하고 원래 객체가 담고 있던 모든 객체를 재귀적으로 복사

>>> import copy
>>> a = [1, 2, [3, 4]]
>>> b = copy.deepcopy(a)
>>> b[2][0] = -100
>>> b
[1, 2, [-100, 4]]
>>> a # a가 변경되지 않은 것에 주목
[1, 2, [3,4]]

3.5 1급 객체

파이썬에서 모든 객체는 '1급(fisrt class)'
이 말은 식별자로 명명될 수 있는 모든 객체는 동일한 지위를 지닌다는 것을 의미

3.6 데이터 표현을 위한 내장 타입

